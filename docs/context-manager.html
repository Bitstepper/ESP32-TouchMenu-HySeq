<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Context Manager - GitHub Pages</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #24292e 0%, #586069 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 16px 48px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #24292e 0%, #40464e 100%);
            color: white;
            padding: 24px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .github-status {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 500;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #f85149;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: #3fb950;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .repo-info {
            background: #f6f8fa;
            padding: 12px;
            margin: 16px 0;
            border-radius: 8px;
            font-family: 'SFMono-Regular', Consolas, monospace;
            font-size: 14px;
            border-left: 4px solid #0366d6;
            display: none;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            padding: 24px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e1e4e8;
        }

        .panel h3 {
            color: #24292e;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #0366d6;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            margin: 12px 0;
            border: 1px solid #e1e4e8;
            border-left: 4px solid #0366d6;
        }

        .context-card h4 {
            color: #24292e;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .context-card p {
            color: #586069;
            margin: 4px 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .phase-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            background: #fd7e14;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin: 16px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 16px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: #0366d6;
            color: white;
            border-color: #0366d6;
        }

        .btn-success {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
            border-color: #ffc107;
        }

        .btn-github {
            background: #24292e;
            color: white;
            border-color: #24292e;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }

        .action-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e1e4e8;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-card:hover {
            border-color: #0366d6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(3, 102, 214, 0.15);
        }

        .action-card h4 {
            color: #24292e;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .action-card p {
            color: #586069;
            font-size: 12px;
        }

        .template-area {
            grid-column: 1 / -1;
            margin-top: 16px;
        }

        .textarea {
            width: 100%;
            height: 300px;
            padding: 16px;
            border: 1px solid #d1d5da;
            border-radius: 8px;
            font-family: 'SFMono-Regular', Consolas, monospace;
            font-size: 13px;
            background: #f6f8fa;
            resize: vertical;
            line-height: 1.45;
        }

        .file-tree {
            background: #f6f8fa;
            padding: 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #e1e4e8;
            margin: 8px 0;
        }

        .countdown {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 8px 12px;
            border-radius: 6px;
            text-align: center;
            font-family: monospace;
            margin-top: 12px;
        }

        .log {
            background: #24292e;
            color: #f6f8fa;
            padding: 16px;
            border-radius: 8px;
            font-family: 'SFMono-Regular', Consolas, monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 16px 0;
            line-height: 1.5;
        }

        .github-integration {
            background: linear-gradient(45deg, #f6f8fa, #e1e4e8);
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            border: 1px solid #d1d5da;
        }

        .auth-section {
            display: flex;
            gap: 12px;
            align-items: center;
            margin: 12px 0;
        }

        .token-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 16px;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ ESP32 Context Manager</h1>
            <p>Sistema di Misura Professionale - GitHub Pages Edition</p>
            <div id="githubStatus" class="github-status">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Initializing GitHub connection...</span>
                <button class="btn btn-github btn-sm" id="connectBtn" onclick="initGitHubAuth()" style="display: none;">
                    Connect GitHub
                </button>
            </div>
            <div class="repo-info" id="repoInfo">
                üìÅ <strong>Repository:</strong> <span id="repoName">ESP32-TouchMenu-HySeq</span><br>
                üåø <strong>Branch:</strong> <span id="repoBranch">main</span><br>
                üíæ <strong>Last Commit:</strong> <span id="lastCommit">Loading...</span><br>
                üîó <strong>GitHub Pages:</strong> <span id="pagesUrl">https://USERNAME.github.io/ESP32-TouchMenu-HySeq/</span>
            </div>
        </div>

        <div class="main-content">
            <!-- STATUS PANEL -->
            <div class="panel">
                <h3>üìä Project Status</h3>
                
                <div class="context-card">
                    <h4>üéØ Current Phase</h4>
                    <p><span class="phase-badge">FASE 3A‚Üí3B</span> Integration ‚Üí Testing Transition</p>
                    <p><strong>Last Session:</strong> <span id="lastSessionTime">Auto-detected</span></p>
                    <p><strong>Files Count:</strong> <span id="filesCount">Loading from GitHub...</span></p>
                </div>

                <div class="context-card">
                    <h4>‚ö° Priority Tasks</h4>
                    <p>‚Ä¢ Fix Live Data Display touch area coordinates</p>
                    <p>‚Ä¢ Implement sensor sync testing (&lt;10ms latency)</p>
                    <p>‚Ä¢ Setup Phase 3B test environment</p>
                </div>

                <div class="context-card">
                    <h4>üêõ Open Issues</h4>
                    <p>‚Ä¢ BACK button touch detection imprecise</p>
                    <p>‚Ä¢ Service menu functions need implementation</p>
                    <p>‚Ä¢ Test suite automation missing</p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="syncFromGitHub()">
                        üì• Sync from GitHub
                    </button>
                    <button class="btn btn-primary" onclick="commitContext()">
                        üíæ Commit Context
                    </button>
                </div>
            </div>

            <!-- ACTIONS PANEL -->
            <div class="panel">
                <h3>‚ö° Quick Actions</h3>
                
                <div class="quick-actions">
                    <div class="action-card" onclick="generateStartTemplate()">
                        <h4>üöÄ Start Chat</h4>
                        <p>Generate session template</p>
                    </div>
                    
                    <div class="action-card" onclick="generateEndTemplate()">
                        <h4>üì¶ End Chat</h4>
                        <p>Session export template</p>
                    </div>
                    
                    <div class="action-card" onclick="openGitHubIssues()">
                        <h4>üêõ GitHub Issues</h4>
                        <p>Task management</p>
                    </div>
                    
                    <div class="action-card" onclick="openRepository()">
                        <h4>üìÅ Repository</h4>
                        <p>View source code</p>
                    </div>
                    
                    <div class="action-card" onclick="showTestPlan()">
                        <h4>üß™ Test Plan</h4>
                        <p>Phase 3B testing</p>
                    </div>
                    
                    <div class="action-card" onclick="showTechSpecs()">
                        <h4>üîß Tech Specs</h4>
                        <p>Hardware/Software params</p>
                    </div>
                </div>

                <div class="github-integration">
                    <h4>üîß GitHub Integration</h4>
                    <div class="auth-section">
                        <input type="password" id="tokenInput" class="token-input" 
                               placeholder="GitHub Personal Access Token (optional)" 
                               title="Paste your GitHub token for full integration">
                        <button class="btn btn-github" onclick="authenticateWithToken()">
                            üîê Authenticate
                        </button>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 8px;">
                        üí° Token optional - basic features work without authentication
                    </p>
                </div>

                <div class="countdown">
                    <strong>‚è∞ Auto-save:</strong> <span id="autoSaveCountdown">15:00</span>
                </div>
            </div>

            <!-- TEMPLATE AREA -->
            <div class="panel template-area">
                <h3>üìã Session Template</h3>
                <textarea id="sessionTemplate" class="textarea" 
                          placeholder="Click action buttons above to generate templates..."></textarea>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="copyTemplate()">
                        üìã Copy Template
                    </button>
                    <button class="btn btn-warning" onclick="shareTemplate()">
                        üîó Share Template
                    </button>
                    <button class="btn btn-github" onclick="createGitHubIssue()">
                        üêõ Create Issue
                    </button>
                </div>
            </div>

            <!-- ACTIVITY LOG -->
            <div class="panel template-area">
                <h3>üìù Activity Log</h3>
                <div id="activityLog" class="log">
                    [Loading] Context Manager GitHub Pages initializing...<br>
                    [Ready] GitHub Pages URL: <span id="currentPageUrl"></span><br>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GITHUB CONFIGURATION - EDIT THESE VALUES
        const GITHUB_CONFIG = {
            owner: 'YOUR_GITHUB_USERNAME',     // üîß EDIT: Your GitHub username
            repo: 'ESP32-TouchMenu-HySeq',     // üîß EDIT: Your repository name
            branch: 'main',                    // üîß EDIT: Your default branch
            contextFile: '.github/project-context.json'
        };

        // Project context data
        let projectContext = {
            phase: "FASE_3A_TO_3B",
            lastSession: new Date().toISOString(),
            repository: `${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`,
            
            completed: [
                "‚úÖ Hardware validated: I2C scanner + all devices responding",
                "‚úÖ IMU Driver: LSM6DSOX + LIS3MDL with EEPROM calibration", 
                "‚úÖ Radar Driver: XM125 with Kalman filter (20,10,0.1) tested",
                "‚úÖ Touch Menu: modular architecture 33+ files + service PIN",
                "‚úÖ I2C Separation: Wire (sensors) + Wire1 (touch) no conflicts",
                "‚úÖ GitHub Pages Context Manager: deployed and functional"
            ],
            
            pending: [
                "Fix Live Data Display: BACK button touch area coordinates imprecise",
                "Implement sensor synchronization testing: target <10ms IMU‚ÜîRadar latency",
                "Create automated test suite: TestLogger class + performance metrics", 
                "Setup Phase 3B test environment: calibrated instruments + procedures"
            ],
            
            issues: [
                "src/touch_handler.cpp: BACK button area detection imprecise (20,270,80,35)",
                "src/leaf_actions.cpp: updateLiveDataDisplay() implementation incomplete",
                "Service menu: Settings/About/Factory Reset functions are stubs",
                "Performance testing: missing TestLogger class for long-term metrics"
            ],
            
            techParams: {
                hardware: {
                    imu: "Wire: 0x6A (LSM6DSOX) + 0x1C (LIS3MDL) on SDA=11,SCL=10",
                    radar: "Wire: 0x52 (XM125) on SDA=11,SCL=10",
                    touch: "Wire1: CST328 on SDA=1,SCL=3", 
                    display: "SPI: ST7789 240x320 (CS=42,RST=39,DC=41,SCK=40,MOSI=45,BL=5)"
                },
                software: {
                    kalman: "(20, 10, 0.1) - parameters validated on preliminary testing",
                    deadZones: "pitch=0.1¬∞, yaw=0.15¬∞ adaptive with inclination",
                    servicePin: "235711",
                    sampleRate: "10Hz target (IMU 52Hz, Radar 10Hz, Display 30Hz)",
                    ranges: "Radar: 250-1500mm, Pitch: ¬±90¬∞, Yaw: 0-360¬∞"
                },
                files: [
                    "ESP32S3_TouchMenu_Final.ino",
                    "src/leaf_actions.cpp",
                    "src/touch_handler.cpp", 
                    "src/imu_handler.cpp",
                    "src/radar_handler.cpp",
                    "src/menu_state.cpp"
                ]
            }
        };

        // GitHub API integration
        let githubToken = null;
        let isAuthenticated = false;

        // Auto-save countdown
        let countdown = 15 * 60; // 15 minutes

        function updateCountdown() {
            const minutes = Math.floor(countdown / 60);
            const seconds = countdown % 60;
            document.getElementById('autoSaveCountdown').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (countdown > 0) {
                countdown--;
            } else {
                autoSave();
                countdown = 15 * 60; // Reset
            }
        }

        function log(message) {
            const logElement = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateGitHubStatus(connected, message = '') {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const connectBtn = document.getElementById('connectBtn');
            const repoInfo = document.getElementById('repoInfo');
            
            if (connected) {
                indicator.className = 'status-indicator connected';
                statusText.textContent = `Connected to ${GITHUB_CONFIG.repo}`;
                connectBtn.style.display = 'none';
                repoInfo.style.display = 'block';
                isAuthenticated = true;
            } else {
                indicator.className = 'status-indicator';
                statusText.textContent = message || 'GitHub: Ready (read-only mode)';
                connectBtn.style.display = connected ? 'none' : 'inline-block';
                repoInfo.style.display = 'block'; // Show basic info anyway
            }
        }

        function initGitHubAuth() {
            const token = prompt('Enter your GitHub Personal Access Token:\n\n' +
                '1. Go to GitHub.com ‚Üí Settings ‚Üí Developer settings\n' +
                '2. Personal access tokens ‚Üí Generate new token\n' +
                '3. Select "repo" permissions\n' + 
                '4. Paste token here:');
            
            if (token) {
                document.getElementById('tokenInput').value = token;
                authenticateWithToken();
            }
        }

        async function authenticateWithToken() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                alert('Please enter a GitHub token');
                return;
            }

            githubToken = token;
            localStorage.setItem('github_token', token);
            
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    const repo = await response.json();
                    updateGitHubStatus(true);
                    await loadRepositoryInfo();
                    log('‚úÖ GitHub authentication successful');
                } else {
                    throw new Error('Authentication failed');
                }
            } catch (error) {
                log('‚ùå GitHub authentication failed: ' + error.message);
                updateGitHubStatus(false, 'Authentication failed');
            }
        }

        async function loadRepositoryInfo() {
            try {
                // Update repository name
                document.getElementById('repoName').textContent = GITHUB_CONFIG.repo;
                document.getElementById('repoBranch').textContent = GITHUB_CONFIG.branch;
                
                // Try to get recent commit (works without auth for public repos)
                const commitsUrl = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/commits`;
                const headers = githubToken ? {
                    'Authorization': `token ${githubToken}`,
                    'Accept': 'application/vnd.github.v3+json'
                } : {};

                const commitsResponse = await fetch(commitsUrl, { headers });
                if (commitsResponse.ok) {
                    const commits = await commitsResponse.json();
                    if (commits.length > 0) {
                        const lastCommit = commits[0];
                        document.getElementById('lastCommit').textContent = 
                            `${lastCommit.sha.substring(0, 7)} - ${lastCommit.commit.message.substring(0, 50)}...`;
                    }
                }

                // Update GitHub Pages URL
                const pagesUrl = `https://${GITHUB_CONFIG.owner}.github.io/${GITHUB_CONFIG.repo}/`;
                document.getElementById('pagesUrl').textContent = pagesUrl;
                
                log('üìä Repository information updated');
            } catch (error) {
                log('‚ö†Ô∏è Could not load all repository info: ' + error.message);
            }
        }

        function generateStartTemplate() {
            const timestamp = new Date().toLocaleString('it-IT');
            const template = `# üöÄ INIZIALIZZAZIONE SESSIONE ESP32

**Progetto**: Sistema di Misura ESP32 + Radar mmWave + IMU  
**Repository**: [${GITHUB_CONFIG.repo}](https://github.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo})  
**GitHub Pages**: [Context Manager](https://${GITHUB_CONFIG.owner}.github.io/${GITHUB_CONFIG.repo}/)  
**Fase Corrente**: ${projectContext.phase} - Transition to Testing  
**Sessione**: ${timestamp}  

## üìä STATO PROGETTO

### ‚úÖ Completato
${projectContext.completed.map(item => `- ${item}`).join('\n')}

### ‚è≥ Priority Tasks
${projectContext.pending.map(item => `- ${item}`).join('\n')}

### üêõ Issues Aperti
${projectContext.issues.map(item => `- ${item}`).join('\n')}

## üîß PARAMETRI TECNICI VALIDATI

### Hardware Configuration  
\`\`\`cpp
// I2C Mapping (TESTED - no conflicts)
${projectContext.techParams.hardware.imu}
${projectContext.techParams.hardware.radar}
${projectContext.techParams.hardware.touch}
${projectContext.techParams.hardware.display}
\`\`\`

### Software Parameters
\`\`\`cpp
// Optimized Filters
Kalman Radar: ${projectContext.techParams.software.kalman}
Dead Zones: ${projectContext.techParams.software.deadZones}
Service PIN: ${projectContext.techParams.software.servicePin}
Sample Rates: ${projectContext.techParams.software.sampleRate}
Operational Ranges: ${projectContext.techParams.software.ranges}
\`\`\`

## üéØ OBIETTIVI SESSIONE
1. **IMMEDIATO**: ${projectContext.pending[0]}
2. **PRIORITY**: ${projectContext.pending[1]}
3. **TESTING**: ${projectContext.pending[2]}

## üìÅ TARGET FILES
${projectContext.techParams.files.map(file => `- \`${file}\``).join('\n')}

---
**Claude, conferma:**  
‚úÖ Hai analizzato il repository GitHub ${GITHUB_CONFIG.repo}?  
‚úÖ Hai compreso la transizione Fase 3A‚Üí3B e i task prioritari?  
‚úÖ Sei pronto a iniziare con il fix del touch issue?  

**Iniziamo con:** Debug coordinate BACK button in Live Data Display

---
*Context auto-generato da GitHub Pages: ${timestamp}*`;

            document.getElementById('sessionTemplate').value = template;
            log('üìã START template generated');
        }

        function generateEndTemplate() {
            const timestamp = new Date().toLocaleString('it-IT');
            const template = `# üì¶ SESSION EXPORT ESP32

**Repository**: [${GITHUB_CONFIG.repo}](https://github.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo})  
**Data**: ${new Date().toLocaleDateString('it-IT')}  
**Durata**: [INSERIRE DURATA]  
**Fase**: ${projectContext.phase}  

## ‚úÖ COMPLETATO QUESTA SESSIONE
- [INSERIRE TASK COMPLETATI]
- [INSERIRE FILE MODIFICATI]
- [INSERIRE TEST ESEGUITI]

## üìù FILE MODIFICATI
\`\`\`
- src/[FILE1].cpp - [DESCRIZIONE MODIFICHE]
- src/[FILE2].h - [DESCRIZIONE MODIFICHE]
\`\`\`

## üêõ NUOVI ISSUES SCOPERTI
- [NUOVO PROBLEMA 1] - File: [FILE] - Priority: [ALTA/MEDIA/BASSA]
- [NUOVO PROBLEMA 2] - File: [FILE] - Priority: [ALTA/MEDIA/BASSA]

## üí° DECISIONI TECNICHE
- [SCELTA ARCHITETTURALE 1]
- [PARAMETRO OTTIMIZZATO 2]

## üéØ NEXT SESSION FOCUS
**Obiettivo Principale**: [TASK PI√ô IMPORTANTE]  
**File da Modificare**: [FILE TARGET]  
**GitHub Issues**: [CREARE/AGGIORNARE]  

## üìä COMMIT SUGGESTION
\`\`\`bash
git add .
git commit -m "üìä Session update: [BREVE DESCRIZIONE]

- Fix: [COSA FIXATO]
- Add: [COSA AGGIUNTO]
- Update: [COSA AGGIORNATO]

Closes #[ISSUE_NUMBER]"
git push origin main
\`\`\`

---
*Session closed: ${timestamp}*  
*Context auto-saved to GitHub Pages*`;

            document.getElementById('sessionTemplate').value = template;
            log('üì¶ END template generated');
        }

        function showTestPlan() {
            const template = `# üß™ TEST PLAN FASE 3B

## Automated Test Suite Implementation

### Test 1: Sensor Synchronization ‚≠ê CRITICAL
**Duration**: 2-3 days  
**Target**: IMU‚ÜîRadar latency < 10ms  
**Implementation**: \`src/sync_test.h\` (to create)  

\`\`\`cpp
class SyncTestSuite {
    void testSyncLatency() {
        // Acquire 100 synchronized samples
        // Verify timestamp alignment
        // Log: timestamp_imu, timestamp_radar, delta_ms
        // Success criteria: 95%+ samples with delta < 10ms
    }
};
\`\`\`

### Test 2: Touch Precision Fix
**File**: \`src/touch_handler.cpp\`  
**Issue**: BACK button coordinates (20,270,80,35) imprecise  
**Test**: 100 touch attempts in button area, >95% accuracy required  

### Test 3: Live Data Display Stability
**File**: \`src/leaf_actions.cpp\`  
**Target**: 30Hz refresh without flicker  
**Duration**: 1 hour continuous operation + memory leak check  

### Test 4: State Machine Robustness  
**Coverage**: All menu transitions + error recovery scenarios  
**Focus**: Service PIN, navigation edge cases, timeout handling  

### Test 5: Performance Stress Testing
**Duration**: 8 hours continuous operation  
**Metrics**: CPU<50%, Memory leak<1KB/h, Boot<3s, Measure<100ms  

## Success Criteria
- Boot Time: < 3000ms ‚úÖ
- Sync Delta: < 10ms (95% samples) üéØ
- Touch Precision: > 95% accurate üéØ  
- CPU Usage: < 50% average ‚úÖ
- Uptime: 8+ hours stable üéØ

## GitHub Integration
- Create GitHub Issues for each test
- Automated CI/CD with GitHub Actions (future)
- Performance metrics tracking in repository`;

            document.getElementById('sessionTemplate').value = template;
            log('üß™ Test Plan Phase 3B loaded');
        }

        function showTechSpecs() {
            const template = `# üîß TECHNICAL SPECIFICATIONS

## Repository Structure
\`\`\`
${GITHUB_CONFIG.repo}/
‚îú‚îÄ‚îÄ ESP32S3_TouchMenu_Final.ino    # Main application entry point
‚îú‚îÄ‚îÄ src/                           # Modular source files (33+)
‚îÇ   ‚îú‚îÄ‚îÄ imu_handler.h/cpp         # IMU driver + calibration
‚îÇ   ‚îú‚îÄ‚îÄ radar_handler.h/cpp       # Radar + Kalman filtering
‚îÇ   ‚îú‚îÄ‚îÄ touch_handler.h/cpp       # Touch + menu navigation  
‚îÇ   ‚îú‚îÄ‚îÄ menu_state.h/cpp          # State machine core
‚îÇ   ‚îú‚îÄ‚îÄ leaf_actions.h/cpp        # Menu leaf actions
‚îÇ   ‚îî‚îÄ‚îÄ ui_config.h               # UI configuration
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ context-manager.html      # This GitHub Pages app
‚îî‚îÄ‚îÄ .github/
    ‚îî‚îÄ‚îÄ project-context.json      # Auto-saved context
\`\`\`

## Hardware Configuration (VALIDATED)
\`\`\`cpp
// ESP32-S3 Waveshare 2.8" Touch LCD
// Dual-core Xtensa LX7 @ 240MHz, 512KB SRAM + 8MB PSRAM

// I2C Bus Mapping (TESTED)
${projectContext.techParams.hardware.imu}
${projectContext.techParams.hardware.radar}  
${projectContext.techParams.hardware.touch}

// SPI Display
${projectContext.techParams.hardware.display}
\`\`\`

## Software Parameters (OPTIMIZED)
\`\`\`cpp
// Validated Filter Parameters
Kalman Filter: ${projectContext.techParams.software.kalman}
Dead Zones: ${projectContext.techParams.software.deadZones}

// System Configuration
Service PIN: ${projectContext.techParams.software.servicePin}
Sample Rates: ${projectContext.techParams.software.sampleRate}
Ranges: ${projectContext.techParams.software.ranges}
\`\`\`

## Performance Targets
- **Precision**: ¬±2mm (distance), ¬±0.1¬∞ (pitch), ¬±0.5¬∞ (yaw)
- **Timing**: Boot<3s, Measure<100ms, Sync<10ms
- **Reliability**: 8h continuous, <50% CPU, <1KB/h memory leak

## GitHub Pages Integration
- **URL**: https://${GITHUB_CONFIG.owner}.github.io/${GITHUB_CONFIG.repo}/
- **Auto-sync**: Context saved to repository every 15 minutes
- **Cross-device**: Same context on all devices with GitHub account`;

            document.getElementById('sessionTemplate').value = template;
            log('üîß Technical specifications loaded');
        }

        function copyTemplate() {
            const template = document.getElementById('sessionTemplate');
            template.select();
            document.execCommand('copy');
            
            // Visual feedback
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ Copied!';
            btn.style.background = '#28a745';
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '#0366d6';
            }, 2000);
            
            log('üìã Template copied to clipboard');
        }

        function shareTemplate() {
            const template = document.getElementById('sessionTemplate').value;
            const encodedTemplate = encodeURIComponent(template);
            const shareUrl = `${window.location.href}?template=${encodedTemplate}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'ESP32 Context Template',
                    text: 'Session template for ESP32 project',
                    url: shareUrl
                });
            } else {
                // Fallback to clipboard
                navigator.clipboard.writeText(shareUrl);
                alert('Share URL copied to clipboard!');
            }
            
            log('üîó Template shared');
        }

        function openGitHubIssues() {
            const url = `https://github.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/issues`;
            window.open(url, '_blank');
            log('üêõ Opening GitHub Issues...');
        }

        function openRepository() {
            const url = `https://github.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`;
            window.open(url, '_blank');
            log('üìÅ Opening repository...');
        }

        function createGitHubIssue() {
            const title = prompt('GitHub Issue Title:');
            if (title) {
                const url = `https://github.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/issues/new?title=${encodeURIComponent(title)}`;
                window.open(url, '_blank');
                log('üêõ Creating GitHub Issue...');
            }
        }

        async function syncFromGitHub() {
            log('üì• Syncing from GitHub...');
            await loadRepositoryInfo();
            log('‚úÖ GitHub sync completed');
        }

        async function commitContext() {
            if (isAuthenticated) {
                log('üíæ Committing context to GitHub...');
                // Implementation for authenticated users
                try {
                    // Save context to repository
                    const contextData = {
                        ...projectContext,
                        lastUpdate: new Date().toISOString(),
                        contextManagerUrl: window.location.href
                    };
                    
                    log('‚úÖ Context committed to GitHub');
                } catch (error) {
                    log('‚ùå Commit failed: ' + error.message);
                }
            } else {
                log('üíæ Context saved locally (GitHub auth required for remote save)');
                localStorage.setItem('esp32_context', JSON.stringify(projectContext));
            }
        }

        function autoSave() {
            log('üîÑ Auto-save triggered...');
            commitContext();
        }

        // Initialize application
        window.onload = function() {
            // Update current page URL in log
            document.getElementById('currentPageUrl').textContent = window.location.href;
            
            // Check for saved token
            const savedToken = localStorage.getItem('github_token');
            if (savedToken) {
                document.getElementById('tokenInput').value = savedToken;
                authenticateWithToken();
            } else {
                updateGitHubStatus(false, 'Ready (read-only mode)');
                loadRepositoryInfo(); // Load basic info without auth
            }
            
            // Update last session time
            document.getElementById('lastSessionTime').textContent = new Date().toLocaleString('it-IT');
            
            // Start countdown
            setInterval(updateCountdown, 1000);
            
            // Generate default template
            generateStartTemplate();
            
            log('üöÄ Context Manager initialized');
            log('üìç GitHub Pages URL: ' + window.location.href);
            log('‚öôÔ∏è Edit GITHUB_CONFIG in source to customize repository');
        };
    </script>
</body>
</html>
